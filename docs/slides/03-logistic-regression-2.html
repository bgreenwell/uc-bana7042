<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-707d8167ce6003fca903bfe2be84ab7f.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.25">

  <meta name="author" content="Brandon M. Greenwell, PhD">
  <title>BANA 7042 – Logistic Regression (Part II)</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #f8f8f2;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #f8f8f2; } /* Normal */
    code span.al { color: #f07178; } /* Alert */
    code span.an { color: #d4d0ab; } /* Annotation */
    code span.at { color: #00e0e0; } /* Attribute */
    code span.bn { color: #d4d0ab; } /* BaseN */
    code span.bu { color: #abe338; } /* BuiltIn */
    code span.cf { color: #ffa07a; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #abe338; } /* Char */
    code span.cn { color: #ffd700; } /* Constant */
    code span.co { color: #f8f8f2; font-style: italic; } /* Comment */
    code span.cv { color: #ffd700; } /* CommentVar */
    code span.do { color: #f8f8f2; } /* Documentation */
    code span.dt { color: #ffa07a; } /* DataType */
    code span.dv { color: #d4d0ab; } /* DecVal */
    code span.er { color: #f07178; text-decoration: underline; } /* Error */
    code span.ex { color: #00e0e0; font-weight: bold; } /* Extension */
    code span.fl { color: #d4d0ab; } /* Float */
    code span.fu { color: #ffa07a; } /* Function */
    code span.im { color: #abe338; } /* Import */
    code span.in { color: #d4d0ab; } /* Information */
    code span.kw { color: #ffa07a; font-weight: bold; } /* Keyword */
    code span.op { color: #ffa07a; } /* Operator */
    code span.ot { color: #00e0e0; } /* Other */
    code span.pp { color: #dcc6e0; } /* Preprocessor */
    code span.re { color: #00e0e0; background-color: #f8f8f2; } /* RegionMarker */
    code span.sc { color: #abe338; } /* SpecialChar */
    code span.ss { color: #abe338; } /* SpecialString */
    code span.st { color: #abe338; } /* String */
    code span.va { color: #00e0e0; } /* Variable */
    code span.vs { color: #abe338; } /* VerbatimString */
    code span.wa { color: #dcc6e0; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-61c09bd4e055c4e147bbfcd77f3179b7.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <link href="../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
  <script src="../site_libs/pagedtable-1.1/js/pagedtable.js"></script>
</head>
<body class="quarto-dark">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Logistic Regression (Part II)</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Brandon M. Greenwell, PhD 
</div>
        <p class="quarto-title-affiliation">
            University of Cincinnati
          </p>
    </div>
</div>

</section>
<section id="western-collaborative-group-study" class="slide level2">
<h2>Western collaborative group study</h2>
<p><span class="math inline">\(N = 3154\)</span> healthy young men aged 39–59 from the San Francisco area were assessed for their personality type. All were free from coronary heart disease at the start of the research. Eight and a half years later change in this situation was recorded. See <code>?faraway::wcgs</code> in R.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="co"># install.packages("faraway")</span></span>
<span id="cb1-2"><a></a><span class="fu">head</span>(wcgs <span class="ot">&lt;-</span> faraway<span class="sc">::</span>wcgs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["age"],"name":[1],"type":["int"],"align":["right"]},{"label":["height"],"name":[2],"type":["int"],"align":["right"]},{"label":["weight"],"name":[3],"type":["int"],"align":["right"]},{"label":["sdp"],"name":[4],"type":["int"],"align":["right"]},{"label":["dbp"],"name":[5],"type":["int"],"align":["right"]},{"label":["chol"],"name":[6],"type":["int"],"align":["right"]},{"label":["behave"],"name":[7],"type":["fct"],"align":["left"]},{"label":["cigs"],"name":[8],"type":["int"],"align":["right"]},{"label":["dibep"],"name":[9],"type":["fct"],"align":["left"]},{"label":["chd"],"name":[10],"type":["fct"],"align":["left"]},{"label":["typechd"],"name":[11],"type":["fct"],"align":["left"]},{"label":["timechd"],"name":[12],"type":["int"],"align":["right"]},{"label":["arcus"],"name":[13],"type":["fct"],"align":["left"]}],"data":[{"1":"49","2":"73","3":"150","4":"110","5":"76","6":"225","7":"A2","8":"25","9":"A","10":"no","11":"none","12":"1664","13":"absent","_rn_":"1"},{"1":"42","2":"70","3":"160","4":"154","5":"84","6":"177","7":"A2","8":"20","9":"A","10":"no","11":"none","12":"3071","13":"present","_rn_":"2"},{"1":"42","2":"69","3":"160","4":"110","5":"78","6":"181","7":"B3","8":"0","9":"B","10":"no","11":"none","12":"3071","13":"absent","_rn_":"3"},{"1":"41","2":"68","3":"152","4":"124","5":"78","6":"132","7":"B4","8":"20","9":"B","10":"no","11":"none","12":"3064","13":"absent","_rn_":"4"},{"1":"59","2":"70","3":"150","4":"144","5":"86","6":"255","7":"B3","8":"20","9":"B","10":"yes","11":"infdeath","12":"1885","13":"present","_rn_":"5"},{"1":"44","2":"72","3":"204","4":"150","5":"90","6":"182","7":"B4","8":"0","9":"B","10":"no","11":"none","12":"3102","13":"absent","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section>
<section id="model-selection" class="title-slide slide level1 center">
<h1>Model selection</h1>

</section>
<section class="slide level2">


<img data-src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExYzRudmd3aDAxcmFvZGRueTFpbHlndHpqYmZ2azZudjM1cHAxbGtlMSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/SaKvh2fShKr1hYZssC/giphy.gif" class="r-stretch"></section>
<section id="exploratory-data-analysis" class="slide level2">
<h2>Exploratory data analysis</h2>
<p>Try fitting a full model first!</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a>lr.fit.all <span class="ot">&lt;-</span> <span class="fu">glm</span>(chd <span class="sc">~</span> ., <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> wcgs)<span class="co">#, maxit = 9999)</span></span>
<span id="cb2-2"><a></a><span class="fu">summary</span>(lr.fit.all)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = chd ~ ., family = binomial(link = "logit"), data = wcgs)

Coefficients: (1 not defined because of singularities)
                  Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)      2.657e+01  2.228e+05   0.000    1.000
age             -3.651e-15  1.208e+03   0.000    1.000
height          -1.087e-14  3.067e+03   0.000    1.000
weight           1.687e-15  3.832e+02   0.000    1.000
sdp              2.409e-15  6.738e+02   0.000    1.000
dbp             -3.019e-15  1.068e+03   0.000    1.000
chol             8.301e-17  1.524e+02   0.000    1.000
behaveA2        -3.044e-14  2.413e+04   0.000    1.000
behaveB3         2.517e-16  2.444e+04   0.000    1.000
behaveB4         5.450e-15  2.937e+04   0.000    1.000
cigs            -9.188e-16  4.526e+02   0.000    1.000
dibepB                  NA         NA      NA       NA
typechdinfdeath -4.405e-06  5.876e+04   0.000    1.000
typechdnone     -5.313e+01  5.223e+04  -0.001    0.999
typechdsilent   -4.400e-06  6.574e+04   0.000    1.000
timechd          1.280e-16  1.080e+01   0.000    1.000
arcuspresent     5.666e-14  1.429e+04   0.000    1.000

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1.7692e+03  on 3139  degrees of freedom
Residual deviance: 1.8217e-08  on 3124  degrees of freedom
  (14 observations deleted due to missingness)
AIC: 32

Number of Fisher Scoring iterations: 25</code></pre>
</div>
</div>
</section>
<section id="exploratory-data-analysis-1" class="slide level2">
<h2>Exploratory data analysis</h2>
<p>Refit without <em>leakage</em> variables <code>typechd</code> and <code>timechd</code>:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a>wcgs <span class="ot">&lt;-</span> <span class="fu">subset</span>(wcgs, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(typechd, timechd))</span>
<span id="cb4-2"><a></a>lr.fit.all <span class="ot">&lt;-</span> <span class="fu">glm</span>(chd <span class="sc">~</span> ., <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> wcgs)<span class="co">#, maxit = 9999)</span></span>
<span id="cb4-3"><a></a><span class="fu">summary</span>(lr.fit.all)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = chd ~ ., family = binomial(link = "logit"), data = wcgs)

Coefficients: (1 not defined because of singularities)
               Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -12.331126   2.350347  -5.247 1.55e-07 ***
age            0.061812   0.012421   4.977 6.47e-07 ***
height         0.006903   0.033335   0.207  0.83594    
weight         0.008637   0.003892   2.219  0.02647 *  
sdp            0.018146   0.006435   2.820  0.00481 ** 
dbp           -0.000916   0.010903  -0.084  0.93305    
chol           0.010726   0.001531   7.006 2.45e-12 ***
behaveA2       0.082920   0.222909   0.372  0.70990    
behaveB3      -0.618013   0.245032  -2.522  0.01166 *  
behaveB4      -0.487224   0.321325  -1.516  0.12944    
cigs           0.021036   0.004298   4.895 9.84e-07 ***
dibepB               NA         NA      NA       NA    
arcuspresent   0.212796   0.143915   1.479  0.13924    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1769.2  on 3139  degrees of freedom
Residual deviance: 1569.1  on 3128  degrees of freedom
  (14 observations deleted due to missingness)
AIC: 1593.1

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
</section>
<section id="whats-going-on-with-dibep" class="slide level2">
<h2>What’s going on with <code>dibep</code>?</h2>
<p>Let’s inspect the data a bit more; we’ll start with a <a href="https://en.wikipedia.org/wiki/Scatter_plot#Scatter_plot_matrices">SPLOM</a></p>
<div class="cell" data-layout-align="center" data-par="true">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a>y <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(wcgs<span class="sc">$</span>chd <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb6-2"><a></a><span class="fu">pairs</span>(wcgs, <span class="at">col =</span> <span class="fu">adjustcolor</span>(y <span class="sc">+</span> <span class="dv">1</span>, <span class="at">alpha.f =</span> <span class="fl">0.1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>

</div>
<img data-src="03-logistic-regression-2_files/figure-revealjs/unnamed-chunk-5-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="check-for-nas" class="slide level2">
<h2>Check for <code>NA</code>s</h2>
<p>The <code>lapply()</code> function (and friends) are quite useful!</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a><span class="co"># Which columns contain missing values?</span></span>
<span id="cb7-2"><a></a><span class="fu">sapply</span>(wcgs, <span class="at">FUN =</span> <span class="cf">function</span>(column) <span class="fu">mean</span>(<span class="fu">is.na</span>(column)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         age       height       weight          sdp          dbp         chol 
0.0000000000 0.0000000000 0.0000000000 0.0000000000 0.0000000000 0.0038046925 
      behave         cigs        dibep          chd        arcus 
0.0000000000 0.0000000000 0.0000000000 0.0000000000 0.0006341154 </code></pre>
</div>
</div>
</section>
<section id="measures-of-association-how-to-choose" class="slide level2 scrollable">
<h2><a href="https://journals.sagepub.com/doi/10.1177/8756479308317006">Measures of Association: How to Choose?</a><sup>1</sup></h2>
<p><img data-src="images/measures-of-association.png"></p>
<aside><ol class="aside-footnotes"><li id="fn1"><p>Nice little paper from Harry Khamis, my old graduate advisor at WSU.</p></li></ol></aside></section>
<section id="check-pairwise-correlations" class="slide level2">
<h2>Check pairwise correlations</h2>
<p>Only looking at numeric columns:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a><span class="co"># Look at correlations between numeric features</span></span>
<span id="cb9-2"><a></a>num <span class="ot">&lt;-</span> <span class="fu">sapply</span>(wcgs, <span class="at">FUN =</span> is.numeric)  <span class="co"># identify numeric columns</span></span>
<span id="cb9-3"><a></a>(corx <span class="ot">&lt;-</span> <span class="fu">cor</span>(wcgs[, num], <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>))  <span class="co"># simple correlation matrix</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                age      height       weight        sdp         dbp
age     1.000000000 -0.09537568 -0.034404537 0.16574640  0.13919776
height -0.095375682  1.00000000  0.532935466 0.01837357  0.01027555
weight -0.034404537  0.53293547  1.000000000 0.25324962  0.29592019
sdp     0.165746397  0.01837357  0.253249623 1.00000000  0.77290641
dbp     0.139197757  0.01027555  0.295920186 0.77290641  1.00000000
chol    0.089188510 -0.08893778  0.008537442 0.12306130  0.12959711
cigs   -0.005033852  0.01491129 -0.081747507 0.02997753 -0.05934232
               chol         cigs
age     0.089188510 -0.005033852
height -0.088937779  0.014911292
weight  0.008537442 -0.081747507
sdp     0.123061297  0.029977529
dbp     0.129597108 -0.059342317
chol    1.000000000  0.096031834
cigs    0.096031834  1.000000000</code></pre>
</div>
</div>
</section>
<section id="check-pairwise-correlations-1" class="slide level2">
<h2>Check pairwise correlations</h2>
<p>Only looking at numeric columns:</p>
<div class="cell" data-layout-align="center" data-par="true">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(corx, <span class="at">method =</span> <span class="st">"square"</span>, <span class="at">order =</span> <span class="st">"FPC"</span>, <span class="at">type =</span> <span class="st">"lower"</span>, <span class="at">diag =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>

</div>
<img data-src="03-logistic-regression-2_files/figure-revealjs/unnamed-chunk-8-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="check-pairwise-correlations-2" class="slide level2">
<h2>Check pairwise correlations</h2>
<p>Pairwise scatterplots with <a href="https://en.wikipedia.org/wiki/Local_regression">LOWESS</a> smoothers:</p>
<div class="cell" data-layout-align="center" data-par="true">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb12-2"><a></a><span class="fu">plot</span>(weight <span class="sc">~</span> height, <span class="at">data =</span> wcgs, <span class="at">col =</span> <span class="fu">adjustcolor</span>(<span class="dv">1</span>, <span class="at">alpha.f =</span> <span class="fl">0.4</span>))</span>
<span id="cb12-3"><a></a><span class="fu">lines</span>(<span class="fu">lowess</span>(<span class="at">x=</span>wcgs<span class="sc">$</span>height, <span class="at">y=</span>wcgs<span class="sc">$</span>weight), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="dv">2</span>)</span>
<span id="cb12-4"><a></a><span class="fu">plot</span>(dbp <span class="sc">~</span> sdp, <span class="at">data =</span> wcgs, <span class="at">col =</span> <span class="fu">adjustcolor</span>(<span class="dv">1</span>, <span class="at">alpha.f =</span> <span class="fl">0.4</span>))</span>
<span id="cb12-5"><a></a><span class="fu">lines</span>(<span class="fu">lowess</span>(wcgs<span class="sc">$</span>sdp, <span class="at">y =</span> wcgs<span class="sc">$</span>dbp), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>

</div>
<img data-src="03-logistic-regression-2_files/figure-revealjs/unnamed-chunk-9-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="what-about-categorical-variables" class="slide level2">
<h2>What about categorical variables?</h2>
<p><a href="https://en.wikipedia.org/wiki/Contingency_table">Contingency table</a> cross-classifying <code>dibep</code> and <code>behave</code>:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a><span class="co"># What about categorical features?</span></span>
<span id="cb13-2"><a></a><span class="fu">xtabs</span>(<span class="sc">~</span> behave <span class="sc">+</span> dibep, <span class="at">data =</span> wcgs)  <span class="co"># perfect correlation?</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      dibep
behave    A    B
    A1  264    0
    A2 1325    0
    B3    0 1216
    B4    0  349</code></pre>
</div>
</div>
</section>
<section id="so-far" class="slide level2">
<h2>So far…</h2>
<ul>
<li><p>As expected, looks like there’s moderate positive correlation between</p>
<ul>
<li><code>sdp</code> and <code>dbp</code></li>
<li><code>height</code> and <code>weight</code></li>
</ul></li>
<li><p>Not necessarily a problem (yet). But how could potentially fix any issues?</p></li>
<li><p>Also looks like some redunancy between the categorical variables <code>dibep</code> and <code>behave</code></p></li>
</ul>
</section>
<section id="looking-more-closely-at-dibep" class="slide level2">
<h2>Looking more closely at <code>dibep</code></h2>
<p>Try a decision tree:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a><span class="co"># What about categorical features?</span></span>
<span id="cb15-2"><a></a>rpart<span class="sc">::</span><span class="fu">rpart</span>(dibep <span class="sc">~</span> ., <span class="at">data =</span> wcgs)  <span class="co"># perfect correlation?</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>n= 3154 

node), split, n, loss, yval, (yprob)
      * denotes terminal node

1) root 3154 1565 A (0.5038047 0.4961953)  
  2) behave=A1,A2 1589    0 A (1.0000000 0.0000000) *
  3) behave=B3,B4 1565    0 B (0.0000000 1.0000000) *</code></pre>
</div>
</div>
<p><br></p>
<p>Looks like <code>dipep</code> can be predicted perfectly from <code>behave</code> (i.e., they are redundant)</p>
</section>
<section id="redundancy-analysis" class="slide level2">
<h2>Redundancy analysis</h2>
<p><a href="https://search.r-project.org/CRAN/refmans/Hmisc/html/redun.html">Redunancy analysis</a> is a powerful tool available in the <a href="">Hmisc</a> package:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a><span class="co"># Notice we're ignoring the response here!</span></span>
<span id="cb17-2"><a></a>Hmisc<span class="sc">::</span><span class="fu">redun</span>(<span class="sc">~</span> . <span class="sc">-</span> chd, <span class="at">nk =</span> <span class="dv">0</span>, <span class="at">data =</span> wcgs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Redundancy Analysis

~age + height + weight + sdp + dbp + chol + behave + cigs + dibep + 
    arcus
&lt;environment: 0x1480da710&gt;

n: 3140     p: 10   nk: 0 

Number of NAs:   0 

Transformation of target variables forced to be linear

R-squared cutoff: 0.9   Type: ordinary 

R^2 with which each variable can be predicted from all other variables:

   age height weight    sdp    dbp   chol behave   cigs  dibep  arcus 
 0.083  0.323  0.379  0.606  0.617  0.054  1.000  0.050  1.000  0.055 

Rendundant variables:

dibep


Predicted from variables:

age height weight sdp dbp chol behave cigs arcus

  Variable Deleted R^2 R^2 after later deletions
1            dibep   1                          </code></pre>
</div>
</div>
</section>
<section id="battery-target" class="slide level2">
<h2>Battery target</h2>
<p>Cool idea from <a href="https://www.minitab.com/en-us/products/spm/">Salford Systems</a> back in the day (now part of Minitab). Think of it as VIFs and redundancy analysis on steroids!</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/C5gGcIUjots?si=3nEcQWEKXvNOR8Ou" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen="">
</iframe>
<p><a href="https://www.youtube.com/watch?v=C5gGcIUjots">Source</a></p>
</section>
<section id="full-model-again" class="slide level2">
<h2>Full model (again)</h2>
<p>This time we’ve removed both the leakage and redundant predictors:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a><span class="co"># Refit model without leakage or redundant features</span></span>
<span id="cb19-2"><a></a><span class="fu">summary</span>(lr.fit.all <span class="ot">&lt;-</span> <span class="fu">glm</span>(chd <span class="sc">~</span> . <span class="sc">-</span> dibep, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> wcgs))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = chd ~ . - dibep, family = binomial(link = "logit"), 
    data = wcgs)

Coefficients:
               Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -12.331126   2.350347  -5.247 1.55e-07 ***
age            0.061812   0.012421   4.977 6.47e-07 ***
height         0.006903   0.033335   0.207  0.83594    
weight         0.008637   0.003892   2.219  0.02647 *  
sdp            0.018146   0.006435   2.820  0.00481 ** 
dbp           -0.000916   0.010903  -0.084  0.93305    
chol           0.010726   0.001531   7.006 2.45e-12 ***
behaveA2       0.082920   0.222909   0.372  0.70990    
behaveB3      -0.618013   0.245032  -2.522  0.01166 *  
behaveB4      -0.487224   0.321325  -1.516  0.12944    
cigs           0.021036   0.004298   4.895 9.84e-07 ***
arcuspresent   0.212796   0.143915   1.479  0.13924    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1769.2  on 3139  degrees of freedom
Residual deviance: 1569.1  on 3128  degrees of freedom
  (14 observations deleted due to missingness)
AIC: 1593.1

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
</section>
<section id="variance-inflation-factors-vifs" class="slide level2">
<h2>Variance inflation factors (VIFs)</h2>
<p>VIFs aren’t built into base R, so here we’ll use the <a href="">car</a> package:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a><span class="co"># Check (generalized) VIFs</span></span>
<span id="cb21-2"><a></a>car<span class="sc">::</span><span class="fu">vif</span>(lr.fit.all)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>           GVIF Df GVIF^(1/(2*Df))
age    1.097698  1        1.047711
height 1.479064  1        1.216168
weight 1.603473  1        1.266283
sdp    2.656210  1        1.629788
dbp    2.796994  1        1.672421
chol   1.029458  1        1.014622
behave 1.030106  3        1.004956
cigs   1.054454  1        1.026866
arcus  1.060879  1        1.029990</code></pre>
</div>
</div>
<p><br></p>
<p>Does anyone recall how VIFs are computed? Try running this with <code>dibep</code> still in the model!</p>
</section>
<section id="body-mass-index-fheight-weight" class="slide level2">
<h2>Body mass index = f(height, weight)</h2>
<ul>
<li><p>Feature engineering is useful in cases where it makes sense!</p></li>
<li><p>Not sure we can combine <code>sdb</code> and <code>dbp</code> in any useful way?!</p></li>
<li><p><code>height</code> and <code>weight</code> can be combined into a single number called <a href="https://en.wikipedia.org/wiki/Body_mass_index">body mass index</a> (BMI): <span class="math inline">\(\text{BMI} = \frac{\text{mass}_\text{lb}}{\text{height}_\text{in}^2} \times 703\)</span></p></li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a>wcgs<span class="sc">$</span>bmi <span class="ot">&lt;-</span> <span class="fu">with</span>(wcgs, <span class="dv">703</span> <span class="sc">*</span> weight <span class="sc">/</span> (height<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb23-2"><a></a><span class="fu">head</span>(wcgs[, <span class="fu">c</span>(<span class="st">"height"</span>, <span class="st">"weight"</span>, <span class="st">"bmi"</span>)])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["height"],"name":[1],"type":["int"],"align":["right"]},{"label":["weight"],"name":[2],"type":["int"],"align":["right"]},{"label":["bmi"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"73","2":"150","3":"19.78795","_rn_":"1"},{"1":"70","2":"160","3":"22.95510","_rn_":"2"},{"1":"69","2":"160","3":"23.62529","_rn_":"3"},{"1":"68","2":"152","3":"23.10900","_rn_":"4"},{"1":"70","2":"150","3":"21.52041","_rn_":"5"},{"1":"72","2":"204","3":"27.66435","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="full-model-again-again" class="slide level2">
<h2>Full model (again again)</h2>
<p>This time, we’ll remove <code>sdb</code>, <code>height</code>, and <code>weight</code>, and include <code>bmi</code>:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a></a><span class="fu">summary</span>(lr.fit.all <span class="ot">&lt;-</span> <span class="fu">update</span>(lr.fit.all, <span class="at">formula =</span> . <span class="sc">~</span> . <span class="sc">+</span> bmi <span class="sc">-</span> sdp <span class="sc">-</span> height <span class="sc">-</span> weight))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = chd ~ age + dbp + chol + behave + cigs + arcus + 
    bmi, family = binomial(link = "logit"), data = wcgs)

Coefficients:
               Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -11.500594   1.026209 -11.207  &lt; 2e-16 ***
age            0.062802   0.012227   5.136 2.80e-07 ***
dbp            0.022652   0.007073   3.203  0.00136 ** 
chol           0.010520   0.001507   6.982 2.90e-12 ***
behaveA2       0.135021   0.222357   0.607  0.54370    
behaveB3      -0.586373   0.244718  -2.396  0.01657 *  
behaveB4      -0.469271   0.320962  -1.462  0.14372    
cigs           0.022668   0.004255   5.327 9.99e-08 ***
arcuspresent   0.223473   0.143358   1.559  0.11903    
bmi            0.060327   0.027311   2.209  0.02718 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1769.2  on 3139  degrees of freedom
Residual deviance: 1579.9  on 3130  degrees of freedom
  (14 observations deleted due to missingness)
AIC: 1599.9

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
</section>
<section id="backward-elimination" class="slide level2">
<h2>Backward elimination</h2>
<ul>
<li><p><a href="https://en.wikipedia.org/wiki/Stepwise_regression">Stepwise procedures</a> work the same here as they did for ordinary linear models</p></li>
<li><p>While base R has the <code>step()</code> function, the <code>stepAIC()</code> function from package <a href="">MASS</a> is a bit better:</p></li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a><span class="fu">summary</span>(lr.fit.back <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">stepAIC</span>(lr.fit.all, <span class="at">direction =</span> <span class="st">"backward"</span>, <span class="at">trace =</span> <span class="dv">0</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = chd ~ age + dbp + chol + behave + cigs + arcus + 
    bmi, family = binomial(link = "logit"), data = wcgs)

Coefficients:
               Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -11.500594   1.026209 -11.207  &lt; 2e-16 ***
age            0.062802   0.012227   5.136 2.80e-07 ***
dbp            0.022652   0.007073   3.203  0.00136 ** 
chol           0.010520   0.001507   6.982 2.90e-12 ***
behaveA2       0.135021   0.222357   0.607  0.54370    
behaveB3      -0.586373   0.244718  -2.396  0.01657 *  
behaveB4      -0.469271   0.320962  -1.462  0.14372    
cigs           0.022668   0.004255   5.327 9.99e-08 ***
arcuspresent   0.223473   0.143358   1.559  0.11903    
bmi            0.060327   0.027311   2.209  0.02718 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1769.2  on 3139  degrees of freedom
Residual deviance: 1579.9  on 3130  degrees of freedom
  (14 observations deleted due to missingness)
AIC: 1599.9

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
</section>
<section id="forward-selection" class="slide level2">
<h2>Forward selection</h2>
<p>Let’s assume we know <code>cigs</code> is relevant for predicting <code>chd</code> (regardless of its statistical significance). So we start with that in the model:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a><span class="co"># Variable selection using forward selection with AIC; which variables were added?</span></span>
<span id="cb28-2"><a></a>m <span class="ot">&lt;-</span> <span class="fu">glm</span>(chd <span class="sc">~</span> cigs, <span class="at">data =</span> wcgs, </span>
<span id="cb28-3"><a></a>         <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb28-4"><a></a>(lr.fit.forward <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">stepAIC</span>(m, <span class="at">direction =</span> <span class="st">"forward"</span>, <span class="at">trace =</span> <span class="dv">0</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  glm(formula = chd ~ cigs, family = binomial(link = "logit"), 
    data = wcgs)

Coefficients:
(Intercept)         cigs  
   -2.74216      0.02322  

Degrees of Freedom: 3153 Total (i.e. Null);  3152 Residual
Null Deviance:      1781 
Residual Deviance: 1750     AIC: 1754</code></pre>
</div>
</div>
</section>
<section id="regularized-regression" class="slide level2">
<h2>Regularized regression</h2>
<ul>
<li><p>Regression coefficients are estimated under various constraints</p></li>
<li><p>Most common approaches include:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Ridge_regression">Ridge regression</a>, which can be useful when dealing with <a href="https://en.wikipedia.org/wiki/Multicollinearity">multicollinearity</a></li>
<li><a href="https://en.wikipedia.org/wiki/Lasso_(statistics)">LASSO</a>, which can be useful for variable selection</li>
<li><a href="https://en.wikipedia.org/wiki/Elastic_net_regularization">Elastic net</a> (ENet) <span class="math inline">\(\approx\)</span> Ridge + LASSO</li>
</ul></li>
<li><p>The <a href="">glmnet</a> package in R, among others, can fit the entire regularization path for many kinds of models, including GLMs and the <a href="https://en.wikipedia.org/wiki/Proportional_hazards_model">Cox PH model</a></p></li>
</ul>
</section>
<section id="useful-resources" class="slide level2">
<h2>Useful resources</h2>
<ul>
<li><p>See Section 6.2 of <a href="https://hastie.su.domains/ISLR2/ISLRv2_website.pdf">ISL book</a> (FREE!!)</p></li>
<li><p><a href="https://bradleyboehmke.github.io/HOML/regularized-regression.html">My HOMLR book with Brad</a> (FREE!!)</p></li>
<li><p>Nice intro video (Python):</p></li>
</ul>
<iframe width="560" height="315" src="https://www.youtube.com/embed/dI7xi5kRwwM?si=Ro1H3-AXmSI7Vqsj" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen="">
</iframe>
</section>
<section id="enet-fit-to-wcgs-data" class="slide level2">
<h2>ENet fit to <code>wcgs</code> data</h2>
<div class="cell" data-layout-align="center" data-par="true">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a></a><span class="fu">library</span>(glmnet)</span>
<span id="cb30-2"><a></a></span>
<span id="cb30-3"><a></a><span class="co"># Fit an elastic net model (i.e., LASSO and ridge penalties) using 5-fold CV</span></span>
<span id="cb30-4"><a></a>wcgs.complete <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(wcgs)</span>
<span id="cb30-5"><a></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span>. <span class="sc">-</span> chd <span class="sc">-</span> dibep <span class="sc">-</span> bmi <span class="sc">-</span> <span class="dv">1</span> , <span class="at">data =</span> wcgs.complete)</span>
<span id="cb30-6"><a></a><span class="co">#lr.enet &lt;- cv.glmnet(X, y = ifelse(wcgs.complete$chd == "yes", 1, 0), </span></span>
<span id="cb30-7"><a></a><span class="co">#                     family = "binomial", nfold = 5, keep = TRUE)</span></span>
<span id="cb30-8"><a></a>lr.enet <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X, <span class="at">y =</span> <span class="fu">ifelse</span>(wcgs.complete<span class="sc">$</span>chd <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>), </span>
<span id="cb30-9"><a></a>                  <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb30-10"><a></a><span class="fu">plot</span>(lr.enet, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">xvar =</span> <span class="st">"lambda"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>

</div>
<img data-src="03-logistic-regression-2_files/figure-revealjs/unnamed-chunk-19-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="enet-fit-to-wcgs-data-1" class="slide level2">
<h2>ENet fit to <code>wcgs</code> data</h2>
<div class="cell" data-layout-align="center" data-par="true">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a></a><span class="fu">library</span>(glmnet)</span>
<span id="cb31-2"><a></a></span>
<span id="cb31-3"><a></a><span class="co"># Fit an elastic net model (i.e., LASSO and ridge penalties) using 5-fold CV</span></span>
<span id="cb31-4"><a></a>lr.enet <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X, <span class="at">y =</span> <span class="fu">ifelse</span>(wcgs.complete<span class="sc">$</span>chd <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>), </span>
<span id="cb31-5"><a></a>                     <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">nfold =</span> <span class="dv">5</span>, <span class="at">keep =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-6"><a></a><span class="fu">plot</span>(lr.enet)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>

</div>
<img data-src="03-logistic-regression-2_files/figure-revealjs/unnamed-chunk-20-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="enet-fit-to-wcgs-data-2" class="slide level2">
<h2>ENet fit to <code>wcgs</code> data</h2>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a></a><span class="fu">coef</span>(lr.enet)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>13 x 1 sparse Matrix of class "dgCMatrix"
               lambda.1se
(Intercept)  -5.557386134
age           0.016230481
height        .          
weight        .          
sdp           0.008155035
dbp           .          
chol          0.005476254
behaveA1      .          
behaveA2      0.017441706
behaveB3      .          
behaveB4      .          
cigs          0.003618991
arcuspresent  .          </code></pre>
</div>
</div>
</section></section>
<section>
<section id="model-performance" class="title-slide slide level1 center">
<h1>Model performance</h1>

</section>
<section id="prediction-accuracy" class="slide level2">
<h2>Prediction accuracy</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Scoring_rule">Scoring rules</a> are used to evaluate probabilistic predictions</li>
<li>A scoring rule is <em>proper</em> if it is minimized in expectation by the true probability</li>
<li>It is a metric that is optimized when the forecasted probabilities are identical to the true outcome probabilities</li>
<li>See <a href="https://www.tandfonline.com/doi/abs/10.1198/016214506000001437">Gneiting &amp; Raftery (2007, JASA)</a> and <a href="https://www.fharrell.com/post/class-damage/">this post</a> for details</li>
<li>Examples include <a href="https://scikit-learn.org/dev/modules/generated/sklearn.metrics.log_loss.html">log loss</a> and the <a href="https://en.wikipedia.org/wiki/Brier_score">Brier score</a> (or MSE)</li>
</ul>
</section>
<section id="statistical-classification" class="slide level2">
<h2>Statistical classification</h2>
<ul>
<li>A <a href="https://en.wikipedia.org/wiki/Statistical_classification">classifier</a> is a model that outputs a class label, as opposed to a probabilistic prediction</li>
<li>Logistic regression is NOT a classifier!!
<ul>
<li>Binary classification via logistic regression represents a forced choice based on a probability threshold</li>
</ul></li>
<li>Classification is rarely useful for decision making (think about a weather app that only prodiced classifications and not forecasts!)</li>
</ul>
</section>
<section id="classification-boundary" class="slide level2">
<h2>Classification boundary</h2>
<p>Perfect seperation (or discrimination):</p>
<div class="cell" data-layout-align="center" data-par="true">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a></a><span class="co"># Simulate some data</span></span>
<span id="cb34-2"><a></a>N <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb34-3"><a></a>d1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">matrix</span>(MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="dv">2</span><span class="sc">*</span>N, <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">Sigma =</span> <span class="fu">diag</span>(<span class="dv">2</span>)), <span class="at">ncol =</span> <span class="dv">2</span>), <span class="dv">0</span>)</span>
<span id="cb34-4"><a></a>d2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">matrix</span>(MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="dv">2</span><span class="sc">*</span>N, <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">8</span>), <span class="at">Sigma =</span> <span class="fu">diag</span>(<span class="dv">2</span>)), <span class="at">ncol =</span> <span class="dv">2</span>), <span class="dv">1</span>)</span>
<span id="cb34-5"><a></a>d <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(d1, d2))</span>
<span id="cb34-6"><a></a><span class="fu">names</span>(d) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"y"</span>)</span>
<span id="cb34-7"><a></a></span>
<span id="cb34-8"><a></a><span class="co"># Fit a logistic regression</span></span>
<span id="cb34-9"><a></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> ., <span class="at">data =</span> d, <span class="at">family =</span> binomial)</span>
<span id="cb34-10"><a></a></span>
<span id="cb34-11"><a></a><span class="co"># Plot decision boundary using 0.5 threshold</span></span>
<span id="cb34-12"><a></a>pfun <span class="ot">&lt;-</span> <span class="cf">function</span>(object, newdata) {</span>
<span id="cb34-13"><a></a>  prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(object, <span class="at">newdata =</span> newdata, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb34-14"><a></a>  label <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(prob <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)  <span class="co"># force into class label</span></span>
<span id="cb34-15"><a></a>  label</span>
<span id="cb34-16"><a></a>}</span>
<span id="cb34-17"><a></a><span class="fu">plot</span>(x2 <span class="sc">~</span> x1, <span class="at">data =</span> d, <span class="at">col =</span> d<span class="sc">$</span>y <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb34-18"><a></a>treemisc<span class="sc">::</span><span class="fu">decision_boundary</span>(fit, <span class="at">train =</span> d, <span class="at">y =</span> <span class="st">"y"</span>, <span class="at">x1 =</span> <span class="st">"x1"</span>, <span class="at">x2 =</span> <span class="st">"x2"</span>, </span>
<span id="cb34-19"><a></a>                            <span class="at">pfun =</span> pfun, <span class="at">grid.resolution =</span> <span class="dv">999</span>)</span>
<span id="cb34-20"><a></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"y = 0"</span>, <span class="st">"y = 1"</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">pch =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>

</div>
<img data-src="03-logistic-regression-2_files/figure-revealjs/unnamed-chunk-22-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="classification-boundary-1" class="slide level2">
<h2>Classification boundary</h2>
<p>Class overlap (four possibilities in terms of classification):</p>
<div class="cell" data-layout-align="center" data-par="true">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a></a><span class="co"># Simulate some data</span></span>
<span id="cb35-2"><a></a>N <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb35-3"><a></a>d1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">matrix</span>(MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="dv">2</span><span class="sc">*</span>N, <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">Sigma =</span> <span class="fu">diag</span>(<span class="dv">2</span>)), <span class="at">ncol =</span> <span class="dv">2</span>), <span class="dv">0</span>)</span>
<span id="cb35-4"><a></a>d2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">matrix</span>(MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="dv">2</span><span class="sc">*</span>N, <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">Sigma =</span> <span class="fu">diag</span>(<span class="dv">2</span>)), <span class="at">ncol =</span> <span class="dv">2</span>), <span class="dv">1</span>)</span>
<span id="cb35-5"><a></a>d <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(d1, d2))</span>
<span id="cb35-6"><a></a><span class="fu">names</span>(d) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"y"</span>)</span>
<span id="cb35-7"><a></a></span>
<span id="cb35-8"><a></a><span class="co"># Fit a logistic regression</span></span>
<span id="cb35-9"><a></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> ., <span class="at">data =</span> d, <span class="at">family =</span> binomial)</span>
<span id="cb35-10"><a></a></span>
<span id="cb35-11"><a></a><span class="co"># Plot decision boundary using 0.5 threshold</span></span>
<span id="cb35-12"><a></a>pfun <span class="ot">&lt;-</span> <span class="cf">function</span>(object, newdata) {</span>
<span id="cb35-13"><a></a>  prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(object, <span class="at">newdata =</span> newdata, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb35-14"><a></a>  label <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(prob <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)  <span class="co"># force into class label</span></span>
<span id="cb35-15"><a></a>  label</span>
<span id="cb35-16"><a></a>}</span>
<span id="cb35-17"><a></a><span class="fu">plot</span>(x2 <span class="sc">~</span> x1, <span class="at">data =</span> d, <span class="at">col =</span> d<span class="sc">$</span>y <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb35-18"><a></a>treemisc<span class="sc">::</span><span class="fu">decision_boundary</span>(fit, <span class="at">train =</span> d, <span class="at">y =</span> <span class="st">"y"</span>, <span class="at">x1 =</span> <span class="st">"x1"</span>, <span class="at">x2 =</span> <span class="st">"x2"</span>, </span>
<span id="cb35-19"><a></a>                            <span class="at">pfun =</span> pfun, <span class="at">grid.resolution =</span> <span class="dv">999</span>)</span>
<span id="cb35-20"><a></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"y = 0"</span>, <span class="st">"y = 1"</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">pch =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>

</div>
<img data-src="03-logistic-regression-2_files/figure-revealjs/unnamed-chunk-23-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="confusion-matrix" class="slide level2">
<h2>Confusion matrix</h2>
<ul>
<li>A <a href="https://en.wikipedia.org/wiki/Confusion_matrix">confusion matrix</a> is a special <a href="https://en.wikipedia.org/wiki/Contingency_table">contingency table</a> that describes the performance of a binary classifier</li>
<li>More of a <a href="https://www.fharrell.com/post/mlconfusion/">matrix of confusion</a> <span class="emoji" data-emoji="scream">😱</span></li>
<li>Lots of statistics can be computed from a given confusion matrix
<ul>
<li>They are all improper scoring rules and can be optimized by a bogus model</li>
<li>Most are not useful for decision making IMO</li>
</ul></li>
</ul>
</section>
<section id="example-with-wcgs-data" class="slide level2">
<h2>Example with <code>wcgs</code> data</h2>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a></a><span class="co"># Confusion matrix (i.e., 2x2 contingency table of classification results)</span></span>
<span id="cb36-2"><a></a>y <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(wcgs)<span class="sc">$</span>chd  <span class="co"># observed classes</span></span>
<span id="cb36-3"><a></a>prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(lr.fit.all, <span class="at">type =</span> <span class="st">"response"</span>)  <span class="co"># predicted probabilities</span></span>
<span id="cb36-4"><a></a>classes <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(prob <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">"yes"</span>, <span class="st">"no"</span>)  <span class="co"># classification based on 0.5 threshold</span></span>
<span id="cb36-5"><a></a>(cm <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="st">"actual"</span> <span class="ot">=</span> y, <span class="st">"predicted"</span> <span class="ot">=</span> classes))  <span class="co"># confusion matrix</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      predicted
actual   no  yes
   no  2883    2
   yes  253    2</code></pre>
</div>
</div>
</section>
<section id="confusion-matrix-1" class="slide level2">
<h2>Confusion matrix</h2>
<p><img data-src="images/confusion-matrix.jpg"> <a href="https://medium.com/@danyal.wainstein1/understanding-the-confusion-matrix-b9bc45ba2679">Source</a></p>
</section>
<section id="roc-curves" class="slide level2">
<h2>ROC curves</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic">Receiver operating characteristic (ROC) curves</a> display the tradeoff between the true positive rate (TPR or sensitivity) and false positive rate (FPR or 1 - specificity) for a range of probability thresholds</li>
<li>Invariant to monotone transformations of <span class="math inline">\(\hat{p}\)</span></li>
<li><a href="https://en.wikipedia.org/wiki/Precision_and_recall#Imbalanced_data">Precision-recall</a> plots can be more informative when dealing with class imbalance (really not a problem with logistic regression or when dealing with probabilities)</li>
</ul>
</section>
<section id="transposed-conditionals" class="slide level2">
<h2>Transposed conditionals</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Confusion_of_the_inverse">Confusion of the inverse</a>: <span class="math inline">\(P\left(A|B\right) \ne P\left(B|A\right)\)</span></li>
<li><a href="https://www.fharrell.com/post/backwards-probs/">The error of the transposed conditional is rampant in research</a>:
<ul>
<li>“Conditioning on what is unknowable to predict what is already known leads to a host of complexities and interpretation problems.”</li>
</ul></li>
<li>TPR and FPR (and others) are <a href="https://en.wikipedia.org/wiki/Confusion_of_the_inverse">transposed conditionals</a> <span class="math display">\[
\begin{align}
TPR &amp;= P\left(\hat{Y} = 1 | Y = 1\right) \\
&amp;= P\left(\text{known} | \text{unknown}\right)
\end{align}
\]</span></li>
</ul>
</section>
<section id="roc-curve-by-hand" class="slide level2">
<h2>ROC curve (by hand)</h2>
<div class="cell" data-layout-align="center" data-par="true">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a></a>threshold <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">length =</span> <span class="dv">999</span>)</span>
<span id="cb38-2"><a></a>tp <span class="ot">&lt;-</span> tn <span class="ot">&lt;-</span> fp <span class="ot">&lt;-</span> fn <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(threshold))</span>
<span id="cb38-3"><a></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(threshold))) {</span>
<span id="cb38-4"><a></a>  classes <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(prob <span class="sc">&gt;</span> threshold[i], <span class="st">"yes"</span>, <span class="st">"no"</span>)</span>
<span id="cb38-5"><a></a>  tp[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(classes <span class="sc">==</span> <span class="st">"yes"</span> <span class="sc">&amp;</span> y <span class="sc">==</span> <span class="st">"yes"</span>)  <span class="co"># true positives</span></span>
<span id="cb38-6"><a></a>  tn[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(classes <span class="sc">==</span> <span class="st">"no"</span>  <span class="sc">&amp;</span> y <span class="sc">==</span> <span class="st">"no"</span>)  <span class="co"># true negatives</span></span>
<span id="cb38-7"><a></a>  fp[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(classes <span class="sc">==</span> <span class="st">"yes"</span> <span class="sc">&amp;</span> y <span class="sc">==</span> <span class="st">"no"</span>)  <span class="co"># false positives</span></span>
<span id="cb38-8"><a></a>  fn[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(classes <span class="sc">==</span> <span class="st">"no"</span>  <span class="sc">&amp;</span> y <span class="sc">==</span> <span class="st">"yes"</span>)  <span class="co"># false negatives</span></span>
<span id="cb38-9"><a></a>}</span>
<span id="cb38-10"><a></a>tpr <span class="ot">&lt;-</span> tp <span class="sc">/</span> (tp <span class="sc">+</span> fn)  <span class="co"># sensitivity</span></span>
<span id="cb38-11"><a></a>tnr <span class="ot">&lt;-</span> tn <span class="sc">/</span> (tn <span class="sc">+</span> fp)  <span class="co"># specificity</span></span>
<span id="cb38-12"><a></a></span>
<span id="cb38-13"><a></a><span class="co"># Plot ROC curve</span></span>
<span id="cb38-14"><a></a><span class="fu">plot</span>(tnr, <span class="at">y =</span> tpr, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">col =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">xlab =</span> <span class="st">"TNR (or specificity)"</span>, </span>
<span id="cb38-15"><a></a>     <span class="at">ylab =</span> <span class="st">"TPR (or sensitivity)"</span>)</span>
<span id="cb38-16"><a></a><span class="fu">abline</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>

</div>
<img data-src="03-logistic-regression-2_files/figure-revealjs/unnamed-chunk-25-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="roc-curve-proc-package" class="slide level2">
<h2>ROC curve (<a href="https://cran.r-project.org/package=pROC">pROC</a> package)</h2>
<p>Can be useful to use a package sometimes (e.g., for computing are under the ROC curve; AKA AUROC or AUC)</p>
<div class="cell" data-layout-align="center" data-par="true">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a></a><span class="fu">plot</span>(roc <span class="ot">&lt;-</span> pROC<span class="sc">::</span><span class="fu">roc</span>(y, <span class="at">predictor =</span> prob))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>

<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a></a>roc</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
roc.default(response = y, predictor = prob)

Data: prob in 2885 controls (y no) &lt; 255 cases (y yes).
Area under the curve: 0.751</code></pre>
</div>
</div>
<img data-src="03-logistic-regression-2_files/figure-revealjs/unnamed-chunk-26-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="leave-one-covariate-out-loco-importance" class="slide level2 scrollable">
<h2>Leave-one-covariate-out (LOCO) importance</h2>
<p>A simple and intuitive way to measure the “importance” of each covariate in a model. In the simplest terms:</p>
<ol type="1">
<li>Estimate baseline performance (e.g., AUROC or Brier score)</li>
<li>For <span class="math inline">\(j = 1, 2, \dots p\)</span>, refit the model without feature <span class="math inline">\(x_j\)</span> and compute the degredation to the baseline performance.</li>
<li>Sort these values in a table or plot them.</li>
</ol>
<p>See <a href="https://slds-lmu.github.io/iml_methods_limitations/pfi.html#leave-one-covariate-out-loco">here</a> for more details.</p>
</section>
<section id="loco-scores-for-wcgs-example" class="slide level2">
<h2>LOCO scores for <code>wcgs</code> example</h2>
<div class="cell" data-layout-align="center" data-par="true">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a></a>wcgs <span class="ot">&lt;-</span> faraway<span class="sc">::</span>wcgs</span>
<span id="cb42-2"><a></a>wcgs<span class="sc">$</span>bmi <span class="ot">&lt;-</span> <span class="fu">with</span>(wcgs, weight <span class="sc">/</span> (height<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> <span class="dv">703</span>)</span>
<span id="cb42-3"><a></a>omit <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"typechd"</span>, <span class="st">"timechd"</span>, <span class="st">"dibep"</span>, <span class="st">"height"</span>, <span class="st">"weight"</span>)</span>
<span id="cb42-4"><a></a>keep <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(wcgs), <span class="at">y =</span> omit)</span>
<span id="cb42-5"><a></a>wcgs <span class="ot">&lt;-</span> wcgs[, keep]</span>
<span id="cb42-6"><a></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(chd <span class="sc">~</span> ., <span class="at">data =</span> wcgs, <span class="at">family =</span> binomial)</span>
<span id="cb42-7"><a></a><span class="fu">summary</span>(fit)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = chd ~ ., family = binomial, data = wcgs)

Coefficients:
               Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -1.168e+01  1.026e+00 -11.387  &lt; 2e-16 ***
age           5.922e-02  1.233e-02   4.804 1.56e-06 ***
sdp           1.806e-02  6.435e-03   2.807   0.0050 ** 
dbp          -3.193e-04  1.087e-02  -0.029   0.9766    
chol          1.047e-02  1.520e-03   6.889 5.64e-12 ***
behaveA2      8.498e-02  2.229e-01   0.381   0.7030    
behaveB3     -6.238e-01  2.449e-01  -2.547   0.0109 *  
behaveB4     -4.994e-01  3.211e-01  -1.555   0.1199    
cigs          2.139e-02  4.294e-03   4.982 6.31e-07 ***
arcuspresent  2.238e-01  1.437e-01   1.558   0.1193    
bmi           5.880e-02  2.717e-02   2.164   0.0305 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1769.2  on 3139  degrees of freedom
Residual deviance: 1572.3  on 3129  degrees of freedom
  (14 observations deleted due to missingness)
AIC: 1594.3

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a></a><span class="co"># Leave-one-covariate-out (LOCO) method</span></span>
<span id="cb44-2"><a></a><span class="co">#</span></span>
<span id="cb44-3"><a></a><span class="co"># Note: Would be better to incorporate some form of cross-validation (or bootstrap)</span></span>
<span id="cb44-4"><a></a>x.names <span class="ot">&lt;-</span> <span class="fu">attr</span>(fit<span class="sc">$</span>terms, <span class="st">"term.labels"</span>)</span>
<span id="cb44-5"><a></a>loco <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(x.names))</span>
<span id="cb44-6"><a></a>baseline <span class="ot">&lt;-</span> <span class="fu">deviance</span>(fit)  <span class="co"># smaller is better; could also use AUROC, Brier score, etc.</span></span>
<span id="cb44-7"><a></a>loco <span class="ot">&lt;-</span> <span class="fu">sapply</span>(x.names, <span class="at">FUN =</span> <span class="cf">function</span>(x.name) {</span>
<span id="cb44-8"><a></a>  wcgs.copy <span class="ot">&lt;-</span> wcgs</span>
<span id="cb44-9"><a></a>  wcgs.copy[[x.name]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb44-10"><a></a>  fit.new <span class="ot">&lt;-</span> <span class="fu">glm</span>(chd <span class="sc">~</span> ., <span class="at">data =</span> wcgs.copy, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb44-11"><a></a>  <span class="fu">deviance</span>(fit.new) <span class="sc">-</span> baseline  <span class="co"># measure drop in performance</span></span>
<span id="cb44-12"><a></a>})</span>
<span id="cb44-13"><a></a><span class="fu">names</span>(loco) <span class="ot">&lt;-</span> x.names</span>
<span id="cb44-14"><a></a><span class="fu">sort</span>(loco, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        chol         cigs          age       behave        arcus          sdp 
5.201189e+01 2.385372e+01 2.298085e+01 2.233397e+01 1.203822e+01 7.647463e+00 
         bmi          dbp 
4.630518e+00 8.624341e-04 </code></pre>
</div>
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a></a><span class="fu">dotchart</span>(<span class="fu">sort</span>(loco, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), <span class="at">pch =</span> <span class="dv">19</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>

</div>
<img data-src="03-logistic-regression-2_files/figure-revealjs/unnamed-chunk-27-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="lift-charts" class="slide level2">
<h2>Lift charts</h2>
<ul>
<li>Classification is a forced choice!</li>
<li>In marketing, analysts generally know better than to try to classify a potential customer as someone to ignore or someone to spend resources on
<ul>
<li>Instead, potential customers are sorted in decreasing order of estimated probability of purchasing a product</li>
<li>The marketer who can afford to advertise to <span class="math inline">\(n\)</span> persons then picks the <span class="math inline">\(n\)</span> highest-probability customers as targets!</li>
</ul></li>
<li>I like the idea of <em>cumulative gain charts</em> for this!</li>
</ul>
</section>
<section id="lift-charts-1" class="slide level2">
<h2>Lift charts</h2>
<p>Cumulative gains chart applied to <code>wcgs</code> example (<code>lr.fit.all</code>):</p>
<div class="cell" data-layout-align="center" data-par="true">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a></a>res <span class="ot">&lt;-</span> treemisc<span class="sc">::</span><span class="fu">lift</span>(prob, <span class="at">y =</span> y, <span class="at">pos.class =</span> <span class="st">"yes"</span>)</span>
<span id="cb47-2"><a></a><span class="fu">plot</span>(res)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>

</div>
<img data-src="03-logistic-regression-2_files/figure-revealjs/unnamed-chunk-28-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="probability-calibration" class="slide level2">
<h2>Probability calibration</h2>
<ul>
<li>A probability <span class="math inline">\(p\)</span> is <em>well calibrated</em> if a fraction of about <em>p</em> of the events we predict with probability <span class="math inline">\(p\)</span> actually occur</li>
<li><a href="https://scikit-learn.org/1.5/modules/calibration.html">Calibration curves</a> are the <span class="emoji" data-emoji="1st_place_medal">🥇</span> gold standard <span class="emoji" data-emoji="1st_place_medal">🥇</span></li>
<li>Compared to general machine learning models, logistic regression tends to return well calibrated probabilities</li>
<li>For details, see <a href="https://www.cs.cornell.edu/~alexn/papers/calibration.icml05.crc.rev3.pdf">Niculescu-Mizil &amp; Caruana (2005)</a> and <a href="https://projecteuclid.org/journals/electronic-journal-of-statistics/volume-11/issue-2/Beyond-sigmoids--How-to-obtain-well-calibrated-probabilities-from/10.1214/17-EJS1338SI.full">Kull et al.&nbsp;(2017)</a> and</li>
</ul>
</section>
<section id="probability-calibration-1" class="slide level2">
<h2>Probability calibration</h2>
<p>The <a href="https://cran.r-project.org/package=rms">rms</a> function <code>val.prob()</code> can be used for this:</p>
<div class="cell" data-layout-align="center" data-par="true">
<details class="code-fold">
<summary>Show R code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a></a>wcgs2 <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(faraway<span class="sc">::</span>wcgs)</span>
<span id="cb48-2"><a></a>y <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(wcgs2<span class="sc">$</span>chd <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb48-3"><a></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> cigs <span class="sc">+</span> height, <span class="at">data =</span> wcgs2, <span class="at">family =</span> binomial)</span>
<span id="cb48-4"><a></a>prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> wcgs2, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb48-5"><a></a>rms<span class="sc">::</span><span class="fu">val.prob</span>(prob, <span class="at">y =</span> y)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>

</div>


<img data-src="03-logistic-regression-2_files/figure-revealjs/unnamed-chunk-29-1.png" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section></section>

    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="images/uc.png" class="slide-logo"></p>
<div class="footer footer-default">
<p>BANA 7042: Statistical Modeling</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 5.0e-2,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>